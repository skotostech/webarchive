<!!!!!!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN"><html>	<head>		<meta http-equiv="content-type" content="text/html;charset=iso-8859-1">		<title>Notes from the Dawn of Time</title>		<meta name="Author" content="FreeFrog Designs (ffdesigns.com)">		<link href="article.css" rel="stylesheet">	</head>	<body background="../artwork/skoot_back.jpg" text="black" link="#006633" vlink="#cc3300" alink="#990066" leftmargin="0" marginheight="0" marginwidth="0" topmargin="0">		<center>			<img src="nav/tnav_dawnof.gif" alt="topnav" height="90" width="531" usemap="#tnav_dawnof" align="BOTTOM" border="0" hspace="10" vspace="10"><map name="tnav_dawnof"><area shape="rect" coords="351,65,519,79" href="../games/succession.html" target="_top"><area shape="rect" coords="350,50,519,63" href="../games/eternal-city.html" target="_top"><area shape="rect" coords="348,33,519,48" href="../games/marrach.html" target="_top"><area shape="rect" coords="261,60,328,89" href="../vbulletin/index.html"><area shape="rect" coords="196,4,250,28" href="../storybuilders/Intro.shtml.html" target="_top"><area shape="rect" coords="11,65,181,77" href="bestof.shtml.html"><area shape="rect" coords="11,49,181,63" href="ArticlesArchive.shtml.html"><area shape="rect" coords="11,35,181,47" href="DAWNOF.shtml.html"><area shape="rect" coords="349,7,517,30" href="../games/m59.html" target="_top"><area shape="rect" coords="10,5,182,32" href="show-column.phtml%3Fcolname=playing.html" target="_top"></map><br>			<table width="90%" border="0" cellpadding="2">				<tr>					<td valign="top">						<div align="left">							<p><font color="#006633"><a href="DAWNOF.shtml.html"><img src="nav/snav_dawnof.gif" alt="Series Info..." height="334" width="137" align="right" border="0" hspace="10" vspace="10"></a><b>Notes from the Dawn of Time #22:</b></font></p>							<h2>A Complete Example</h2>							<p><b><i>by <a href="mailto:richard@mud.co.uk">Richard Bartle<br>										</a>July 3, 2002</i></b></p>							<div class="Section1">								<p>Here&#146;s an example of the complete parsing process (as described in my previous 13 articles) in action.</p>								<h3>Phase 1 - Command Line Input</h3>								<p>The user types a sequence of characters. Let&#146;s go with something that players might actually type, rather than something that illustrates the finer points of parsing:<br>									<br>									dr t x diamons^Hds in box<br>									<br>									(English translation: DROP ALL TREASURE EXCLUDING DIAMONDS IN THE BOX).</p>								<h3>Phase 2 &#150; Pre-processing</h3>								<p>The input line is normalised. White space is removed, control characters are processed and letters are converted to same-case.<br>									<br>									DR T X DIAMONDS IN BOX</p>								<h3>Phase 3 &#150; Tokenisation</h3>								<p>The pre-processed line is split into words, which are looked up in the vocabulary. If a word doesn&#146;t have a vocabulary entry, this is reported and the parsing process stops.<br>									<br>									With a vocabulary that includes the following:</p>								<blockquote>									<table border="0" cellspacing="3" cellpadding="3">										<tr>											<td valign="top"><b>Word</b></td>											<td valign="top"><b>PoS</b></td>											<td valign="top"><b>Atom</b></td>											<td valign="top"><b>Comment</b></td>										</tr>										<tr>											<td valign="top">&lt;dr</td>											<td valign="top">verb</td>											<td valign="top">drop&gt;</td>											<td valign="top"></td>										</tr>										<tr>											<td valign="top">&lt;t</td>											<td valign="top">noun</td>											<td valign="top">treasure_plural&gt;</td>											<td valign="top">T default to plural</td>										</tr>										<tr>											<td valign="top">&lt;t</td>											<td valign="top">adjective</td>											<td valign="top">treasure_adj</td>											<td valign="top">for TREASURE MAP</td>										</tr>										<tr>											<td valign="top">&lt;t</td>											<td valign="top">verb</td>											<td valign="top">get&gt;</td>											<td valign="top">short for TAKE</td>										</tr>										<tr>											<td valign="top">&lt;x</td>											<td valign="top">preposition</td>											<td valign="top">but&gt;</td>											<td valign="top">short for EXCEPT</td>										</tr>										<tr>											<td valign="top">&lt;diamonds</td>											<td valign="top">noun</td>											<td valign="top">diamond_plural&gt;</td>											<td valign="top"></td>										</tr>										<tr>											<td valign="top">&lt;in</td>											<td valign="top">preposition</td>											<td valign="top">in&gt;</td>											<td valign="top"></td>										</tr>										<tr>											<td valign="top">&lt;in</td>											<td valign="top">adverb</td>											<td valign="top">in&gt;</td>											<td valign="top"></td>										</tr>										<tr>											<td valign="top">&lt;box</td>											<td valign="top">noun</td>											<td valign="top">box&gt;</td>											<td valign="top"></td>										</tr>										<tr>											<td valign="top">&lt;box</td>											<td valign="top">verb</td>											<td valign="top">hit&gt;</td>											<td valign="top"></td>										</tr>									</table>								</blockquote>								<p>the tokenisation that results would be:</p>								<blockquote>									<table border="0" cellspacing="3" cellpadding="3">										<tr>											<td valign="top"><b>Word </b></td>											<td valign="top">DR</td>											<td valign="top">T</td>											<td valign="top">X</td>											<td valign="top">DIAMONDS</td>											<td valign="top">IN</td>											<td valign="top">BOX</td>										</tr>										<tr>											<td valign="top"><b>Number</b></td>											<td valign="top">1</td>											<td valign="top">2</td>											<td valign="top">3</td>											<td valign="top">4</td>											<td valign="top">5</td>											<td valign="top">6</td>										</tr>										<tr>											<td valign="top"><b>PoS</b></td>											<td valign="top">verb</td>											<td valign="top">noun<br>												adjective<br>												verb</td>											<td valign="top">prep</td>											<td valign="top">noun</td>											<td valign="top">prep<br>												adverb</td>											<td valign="top">noun<br>												verb</td>										</tr>									</table>								</blockquote>								<h3>Phase 4 &#150; Parsing</h3>								<p>There&#146;s an ambiguity in the input sentence, depending on how its prepositions are read. It could mean:</p>								<ul>									<li>DR (T X DIAMONDS IN BOX)									<li>DR (T) X (DIAMONDS IN BOX)									<li>DR (T X DIAMONDS) IN (BOX)								</ul>								<p>How this is resolved is, in theory, entirely up to the parser &#150; so long as it does whatever it does consistently. However, the first alternative is bad because it means DROP can&#146;t ever take 2 parameters, and the second is bad because players almost invariably prefer to specify the subject (ie. first parameter) rather than the object (ie. second parameter). Trust me: even if you have to hack your parser to get the third possibility, do so! In MUD2, I implement it by having two types of preposition: those that connect noun phrases and those that connect noun groups. IN is one of the former and X is one of the latter, which together enforce the third reading of the command. This is how it&#146;s done in the following trace:</p>								<pre>                                                            current:                                                            DR+ parse([r_input])| + parse([r_sentence, r_inpa])| | + parse([r_command, r_snta, r_inpa])| | | + parse([r_command1, r_snta, r_inpa])| | | | + parse([r_cmd1a, r_snta, r_inpa])| | | | | + current(verb)| | | | | - current(verb) =true                             T| | | | | + parse([r_noun_phrase, r_cmd1b, r_snta, r_inpa])| | | | | | + parse([r_noun_group, r_npa, r_cmd1b, ... ])| | | | | | | + current(article)| | | | | | | - current(article) =false             | | | | | | | + parse([r_nga, r_npa, r_cmd1b, ...])| | | | | | | | + current(integer)| | | | | | | | - current(integer) =false| | | | | | | | + parse([r_ngb, r_npa, r_cmd1b, ...])| | | | | | | | | + current(adjective)| | | | | | | | | - current(adjective) =false| | | | | | | | | + parse([r_ngc, r_npa, r_cmd1b, ...])| | | | | | | | | | + current(noun)| | | | | | | | | | - current(noun) =true                   X| | | | | | | | | | + parse([r_npa, r_cmd1b, ...])| | | | | | | | | | | + current(ng_prep)| | | | | | | | | | | - current(ng_prep) =true              DIAMONDS| | | | | | | | | | | + parse([r_noun_group, r_npa, r_cmd1b, ... ])...| | | | | | | | | | | | + current(noun)| | | | | | | | | | | | - current(noun) =true               IN| | | | | | | | | | | | + parse([r_npa, r_cmd1c, ...])| | | | | | | | | | | | | + current(ng_prep)| | | | | | | | | | | | | - current(ng_prep) =false| | | | | | | | | | | | | + parse([r_cmd1d, ...])| | | | | | | | | | | | | | + parse([r_cmd1e, ...])| | | | | | | | | | | | | | | + current(np_prep)| | | | | | | | | | | | | | | - current(np_prep) =true      BOX| | | | | | | | | | | | | | | + parse([r_noun_phrase, r_cmd1f, ...])...                                                         EOL| | | | | | | | | | | | | | -parse([r_cmd1e, ...])| | | | | | | | | | | | | - parse([r_cmd1d, ...])| | | | | | | | | | | | - parse([r_npa, r_cmd1c, ...])...| | | - parse([r_command1, r_snta, r_inpa]) =true| | - parse([r_command, r_snta, r_inpa]) =true| - parse([r_sentence, r_inpa]) =true- parse([r_input]) =true</pre>								<h3>Phase 5 &#150; Binding</h3>								<p>From the parse phase, we get</p>								<pre>[drop, [in],    [   [treasure_plural,            [but, [diamond_plural]]        ],        [box, []]    ]]</pre>								<p>First, the binder identifies the verb by applying each verb modifier to it. If we&#146;ve defined</p>								<blockquote>									<p>{ in drop }: insert</p>								</blockquote>								<p>then the verb becomes INSERT.<br>									<br>									Next, the binder has to bind the nouns, in the context of INSERT. For TREASURE_PLURAL, this means all the objects of class TREASURE that the player&#146;s character is carrying. Let&#146;s say that this gives</p>								<blockquote>									<p>[ruby1, ruby2, diamond0, diamond2, ring7]</p>								</blockquote>								<p>This set has to be modified by the BUT clause. That clause requires that DIAMOND_PLURAL be bound in the context of INSERT, which gives</p>								<blockquote>									<p>[diamond0, diamond2]</p>								</blockquote>								<p>We can now apply</p>								<blockquote>									<p>but([ruby1, ruby2, diamond0, diamond2, ring7], [diamond0, diamond2])</p>								</blockquote>								<p>to get [ruby1, ruby2, ring7] for the set of objects that satisfy the first noun phrase.</p>								<p>For the second noun phrase, we have to bind BOX in the context of being the second parameter to DROP. Let&#146;s say it finds [box2, box5].<br>									<br>									So finally the binder has the following information:</p>								<blockquote>									<table border="0" cellspacing="3" cellpadding="3">										<tr>											<td>Function:</td>											<td>insert</td>										</tr>										<tr>											<td>First parameter list:</td>											<td>[ruby1, ruby2, ring7]</td>										</tr>										<tr>											<td>Second parameter list:</td>											<td>[box2, box5]</td>										</tr>									</table>									<p>It therefore makes 3 function calls:</p>									<p>insert(ruby1, box2)<br>										insert(ruby2, box2)<br>										insert(ring7, box2)</p>								</blockquote>								<h3>Phase 6 &#150; Execution</h3>								<p>Each execution inserts one object into box2 and generates the appropriate messages. The player reads the messages and decides what to do next. The whole process can then begin again.<br>									<br>									For us, however, this marks the end of this series of articles on parsing &#150; at last!<br>									<br>									Next column, I&#146;ll start on a fresh topic: mobile AI.</p>							</div>							<div align="left">												<table width="100%">													<tr>														<td align="center" valign="middle">															<p><b>Recent Discussions on <i>Notes from the Dawn of Time</i>:</b></p>														</td>													</tr>													<tr>														<td align="center" valign="middle">															<p><!--#include file="dawnof-last10.php"-->															</p>														</td>													</tr>													<tr>														<td align="center" valign="middle"><b><a href="http://forum.skotos.net/forumdisplay.php?s=&forumid=33"><img src="artwork/jumpto.gif" alt="jump" height="20" width="98" align="absmiddle" border="0"></a> <a href="http://forum.skotos.net/newthread.php?s=&action=newthread&forumid=33"><img src="artwork/postnew.gif" alt="new" height="20" width="98" align="absmiddle" border="0"></a></b></td>													</tr>												</table>							</div>						</div>					</td>				</tr>				<tr>					<td valign="top"></td>				</tr>			</table>			<p></p>		</center>	</body></html>